#!/bin/sh -eux

cat << EOF > /etc/yum.repos.d/CentOS-Base.repo
#openshift
[openshift]
name=CentOS-OpenShift
baseurl=http://mirror.centos.org/centos/7/paas/x86_64/openshift-origin/
gpgcheck=1
enabled=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-PaaS
EOF

PRE_INSTALL_PKGS='epel-release centos-release-openshift-origin'
INSTALL_PKGS='ansible socat python python-pip wget git net-tools bind-utils iptables-services bridge-utils bash-completion origin-clients kexec-tools sos psacct isci-initiator-utils'

yum update
yum install -y $PRE_INSTALL_PKGS
yum install -y $INSTALL_PKGS

pip install --upgrade pip

curl https://raw.githubusercontent.com/joshuacox/roustabout/master/RHkubeNstall|bash


#edit /etc/sysconfig/docker file and add --insecure-registry 172.30.0.0/16 to the OPTIONS parameter.
sed -i '/OPTIONS=.*/c\OPTIONS="--selinux-enabled --insecure-registry 172.30.0.0/16"' \
	+  /etc/sysconfig/docker
systemctl is-active docker
systemctl enable docker
systemctl start docker

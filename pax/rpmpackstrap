#!/bin/sh -eux
TMP=$(mktemp -d)
PRE_INSTALL_PKGS='epel-release'
INSTALL_PKGS='docker ansible socat python python-pip wget git net-tools bind-utils iptables-services bridge-utils bash-completion kexec-tools sos psacct isci-initiator-utils yum-utils'

cd $TMP
wget https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
yum install -y epel-release-latest-7.noarch.rpm

yum clean all
yum update -y
yum repolist enabled

yum install -y $PRE_INSTALL_PKGS
yum install -y $INSTALL_PKGS

if [ "$OPENSHIFT_INSTALL" = "true" ]; then
  yum install -y centos-release-openshift-origin origin-clients
elif [ "$KUBEADM_INSTALL" = "true" ]; then
  curl -s https://raw.githubusercontent.com/joshuacox/roustabout/master/RHkubeNstall|bash
fi

#pip install --upgrade pip

#edit /etc/sysconfig/docker file and add --insecure-registry 172.30.0.0/16 to the OPTIONS parameter.
sed -i '/OPTIONS=.*/c\OPTIONS="--selinux-enabled --insecure-registry 172.30.0.0/16"' \
  /etc/sysconfig/docker
systemctl enable docker
systemctl start docker

# remove temp
cd
rm -Rf $TMP
